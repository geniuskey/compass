# TMM 검증 결과

이 페이지는 COMPASS에서 실제 실행한 시뮬레이션 결과를 문서화합니다. 표준 1.0 um BSI 픽셀 스택에 TMM (Transfer Matrix Method) 솔버를 사용했습니다. TMM은 스택을 1D 평면 박막 구조로 처리하여, RCWA 시뮬레이션 전 빠른 스택 설계, BARL 최적화, 기준 검증에 적합합니다.

::: info 솔버 참고
TMM은 1D 솔버입니다 — 횡방향 패터닝(마이크로렌즈 형상, Bayer CF 패턴, DTI, 메탈 그리드)을 무시합니다. 완전한 2D/3D 효과를 보려면 RCWA 솔버(torcwa, grcwa, meent, fmmax)를 사용하세요. TMM 결과는 빠른 기준선 및 반사 방지 코팅 설계 도구 역할을 합니다.
:::

## 픽셀 스택 구조

시뮬레이션한 1.0 um 피치 BSI (후면 조사) 픽셀 스택은 9개 레이어로 구성됩니다. 빛은 air(상단)에서 스택을 통과하여 silicon(하단)으로 전파됩니다.

| 레이어 | 재료 | 두께 (um) | 패터닝 | n @ 550nm |
|--------|------|:---------:|:------:|:---------:|
| air | air | 1.000 | - | 1.000 |
| microlens | polymer_n1p56 | 0.600 | Yes | 1.573 |
| planarization | SiO₂ | 0.300 | - | 1.460 |
| color_filter | cf_green | 0.600 | Yes | 1.55+0.02i |
| barl_3 | Si₃N₄ | 0.030 | - | 2.023 |
| barl_2 | SiO₂ | 0.015 | - | 1.460 |
| barl_1 | HfO₂ | 0.025 | - | 1.966 |
| barl_0 | SiO₂ | 0.010 | - | 1.460 |
| silicon | silicon | 3.000 | Yes | 4.08+0.03i |

- **총 스택 높이**: 5.580 um
- **BARL**: 4층 SiO₂/HfO₂/SiO₂/Si₃N₄ 반사 방지 스택 (총 80 nm)
- **Bayer 패턴**: RGGB 2×2 단위 셀

## 파장 스윕: 380–780 nm

수직 입사, 무편광 조건에서의 전체 가시광 스펙트럼 스윕.

```
솔버: TMM | 픽셀: 1.0um BSI | 각도: 0° | 편광: 무편광
실행 시간: 2.8 ms (41개 파장)
```

| λ (nm) | R | T | A | R+T+A |
|-------:|------:|------:|------:|--------:|
| 380 | 0.0401 | 0.0517 | 0.9081 | 1.000000 |
| 400 | 0.0529 | 0.0722 | 0.8750 | 1.000000 |
| 420 | 0.0961 | 0.0830 | 0.8210 | 1.000000 |
| 440 | 0.0348 | 0.1085 | 0.8566 | 1.000000 |
| 460 | 0.0633 | 0.1443 | 0.7923 | 1.000000 |
| 480 | 0.0324 | 0.2549 | 0.7127 | 1.000000 |
| 500 | 0.1461 | 0.4549 | 0.3990 | 1.000000 |
| 520 | 0.0088 | 0.9135 | 0.0777 | 1.000000 |
| 540 | 0.2405 | 0.7023 | 0.0572 | 1.000000 |
| 560 | 0.1697 | 0.4775 | 0.3528 | 1.000000 |
| 580 | 0.0280 | 0.3331 | 0.6389 | 1.000000 |
| 600 | 0.0387 | 0.2423 | 0.7190 | 1.000000 |
| 620 | 0.0477 | 0.2175 | 0.7349 | 1.000000 |
| 640 | 0.0180 | 0.2258 | 0.7563 | 1.000000 |
| 660 | 0.0209 | 0.2336 | 0.7455 | 1.000000 |
| 680 | 0.0781 | 0.2284 | 0.6935 | 1.000000 |
| 700 | 0.1199 | 0.2252 | 0.6549 | 1.000000 |
| 720 | 0.1091 | 0.2345 | 0.6564 | 1.000000 |
| 740 | 0.0664 | 0.2522 | 0.6815 | 1.000000 |
| 760 | 0.0372 | 0.2667 | 0.6961 | 1.000000 |
| 780 | 0.0430 | 0.2721 | 0.6849 | 1.000000 |

**주요 관찰:**
- **최대 흡수율(90.8%)** 380 nm — 단파장에서 실리콘의 큰 소광 계수(k ≈ 0.34)로 인해 거의 완전 흡수가 발생합니다.
- **520 nm에서 투과율 급증** — BARL과 박막 간섭이 520 nm에서 투과 창(T = 0.91)을 만들어, 실리콘 흡수를 7.8%로 감소시킵니다. 이것은 스택 내 Fabry-Pérot 공진입니다.
- **장파장 (> 600 nm)** — 실리콘의 소광 계수 감소에 따라 흡수율이 65–75% 수준에서 안정화됩니다.

## 에너지 보존 검증

```
파장 범위      : 380–780 nm (1 nm 간격, 41개 포인트)
최대 |R+T+A − 1| : 1.11 × 10⁻¹⁶
평균 |R+T+A − 1| : 1.08 × 10⁻¹⁷
상태             : PASS ✓
```

TMM은 이산화 오차가 없는 해석적 방법이므로, 예상대로 기계 정밀도 수준의 에너지 보존을 달성합니다.

## 편광 분해 각도 스윕

550 nm에서 TE, TM, 무편광 입사에 대한 0–80° 반사율, 투과율, 흡수율.

| 각도 | R_TE | T_TE | A_TE | R_TM | T_TM | A_TM | R_unpol |
|-----:|------:|------:|------:|------:|------:|------:|--------:|
| 0° | 0.2526 | 0.5618 | 0.1856 | 0.2526 | 0.5618 | 0.1856 | 0.2526 |
| 10° | 0.2509 | 0.5615 | 0.1875 | 0.2410 | 0.5694 | 0.1896 | 0.2460 |
| 20° | 0.1886 | 0.6036 | 0.2079 | 0.1558 | 0.6298 | 0.2145 | 0.1722 |
| 30° | 0.0143 | 0.7252 | 0.2606 | 0.0089 | 0.7340 | 0.2570 | 0.0116 |
| 40° | 0.1398 | 0.6263 | 0.2339 | 0.0664 | 0.6869 | 0.2467 | 0.1031 |
| 50° | 0.1866 | 0.5875 | 0.2258 | 0.0458 | 0.6968 | 0.2574 | 0.1162 |
| 60° | 0.0740 | 0.6626 | 0.2634 | 0.0597 | 0.6790 | 0.2613 | 0.0669 |
| 70° | 0.5079 | 0.3471 | 0.1450 | 0.0283 | 0.6926 | 0.2792 | 0.2681 |
| 80° | 0.7312 | 0.1870 | 0.0818 | 0.1200 | 0.6210 | 0.2590 | 0.4256 |

**주요 관찰:**
- **30° 부근 Brewster 유사 최소값** — TE와 TM 모두 R이 ~1%로 감소합니다. 이것은 단일 계면의 Brewster 각이 아니라 다층 스택의 상쇄 간섭 최소값입니다.
- **40° 이상에서 TE vs TM 분기** — Fresnel 방정식에서 예상되는 대로, TM은 낮은 반사율을 유지하는 반면 TE 반사율은 급격히 증가합니다.
- **스침 입사 (80°)** — TE 반사율이 73%에 도달하는 반면, TM은 12%로 유지되어 강한 편광 분리를 보여줍니다.

## BARL 반사 방지 스택 영향

550 nm에서 4층 BARL (Bottom Anti-Reflection Layer)의 광학 성능에 대한 영향.

| 구성 | R | T | A |
|------|------:|------:|------:|
| BARL 없음 | 0.0434 | 0.6877 | 0.2689 |
| 표준 4층 BARL | 0.2526 | 0.5618 | 0.1856 |
| 2배 두께 BARL | 0.0240 | 0.6958 | 0.2802 |

::: warning 해석
550 nm에서 표준 BARL 구성은 최적 반사 방지 지점이 아닙니다 — BARL 없는 경우보다 오히려 반사가 증가합니다. 이는 BARL이 단일 파장이 아닌 380–780 nm 광대역 성능에 최적화되어 있기 때문입니다. 2배 두께 BARL은 550 nm에서 더 나은 반사 방지(R = 2.4%)를 달성하지만, 광대역 특성은 다를 수 있습니다. BARL 최적화에는 전체 파장 스윕 분석이 필요합니다.
:::

## 재료 굴절률

모든 스택 재료의 주요 파장에서의 복소 굴절률 (n + ik). COMPASS `MaterialDB`의 테이블 데이터를 3차 스플라인 보간한 값입니다.

| 재료 | 400 nm | 450 nm | 500 nm | 550 nm | 600 nm | 650 nm | 700 nm |
|------|-------:|-------:|-------:|-------:|-------:|-------:|-------:|
| air | 1.0000 | 1.0000 | 1.0000 | 1.0000 | 1.0000 | 1.0000 | 1.0000 |
| polymer_n1p56 | 1.5850 | 1.5798 | 1.5760 | 1.5732 | 1.5711 | 1.5695 | 1.5682 |
| SiO₂ | 1.4701 | 1.4656 | 1.4623 | 1.4599 | 1.4580 | 1.4565 | 1.4553 |
| cf_green | 1.55+0.12i | 1.55+0.11i | 1.55+0.04i | 1.55+0.02i | 1.55+0.10i | 1.55+0.12i | 1.55+0.12i |
| HfO₂ | 2.0250 | 1.9988 | 1.9800 | 1.9661 | 1.9556 | 1.9473 | 1.9408 |
| Si₃N₄ | 2.0726 | 2.0500 | 2.0344 | 2.0232 | 2.0149 | 2.0085 | 2.0035 |
| silicon | 5.38+0.34i | 4.64+0.21i | 4.21+0.13i | 4.08+0.03i | 3.88+0.05i | 3.80+0.04i | 3.75+0.03i |
| tungsten | 3.46+2.72i | 3.55+2.86i | 3.61+2.98i | 3.65+3.08i | 3.68+3.17i | 3.70+3.25i | 3.72+3.33i |

**참고:**
- **실리콘**은 강한 분산을 가짐: n이 5.38 (400 nm)에서 3.75 (700 nm)로 감소합니다. 소광 계수 k는 단파장(UV 흡수 에지)에서 최대입니다.
- **컬러 필터 (green)**는 500–550 nm 근처에 통과 대역이 있으며 k가 최소화(0.02–0.04)되고, 차단 영역(400 nm, >600 nm)에서는 k > 0.10입니다.
- **텅스텐** (메탈 그리드 재료)은 난반사 금속답게 모든 파장에서 높은 k 값을 가집니다.

## 스넬 법칙 CRA 시프트 vs 탄젠트 근사

업그레이드된 스넬 법칙 광선 추적 시프트(모든 중간 레이어를 통과)와 이전 탄젠트 근사(`Δx = tan(CRA) × h × 0.5`)의 비교.

| CRA (deg) | 스넬 시프트 (um) | tan 근사 (um) | 차이 (um) |
|----------:|:----------------:|:----------------:|:----------------:|
| 0° | 0.000000 | 0.000000 | 0.000000 |
| 5° | 0.109021 | 0.026247 | +0.082775 |
| 10° | 0.217825 | 0.052898 | +0.164927 |
| 15° | 0.326181 | 0.080385 | +0.245796 |
| 20° | 0.433829 | 0.109191 | +0.324638 |
| 25° | 0.540466 | 0.139892 | +0.400574 |
| 30° | 0.645724 | 0.173205 | +0.472518 |

**주요 관찰:**
- **스넬 시프트는 탄젠트 근사보다 3–4배 큼** — 탄젠트 공식은 마이크로렌즈 높이(0.6 um × 0.5)만 고려했지만, 스넬 법칙은 마이크로렌즈 아래 전체 스택을 추적합니다: 평탄화층(0.3 um, n=1.46), 컬러 필터(0.6 um, n=1.55), BARL(0.08 um, n=1.46–2.02), 실리콘에서 포토다이오드 중심까지(0.5 um, n=4.08).
- **굴절이 각 계면에서 각도를 줄임** (스넬 법칙: n₁ sin θ₁ = n₂ sin θ₂), 따라서 레이어당 횡방향 변위는 기하학적 `tan(θ)`보다 작지만, 모든 레이어를 고려하면 총 누적 시프트가 더 큽니다.
- **30° CRA**에서 스넬 시프트는 0.646 um — 픽셀 피치(1.0 um)의 절반 이상으로, 센서 가장자리에서 적절한 마이크로렌즈 정렬이 매우 중요함을 나타냅니다.

::: tip CRA 분석에서 TMM vs RCWA
TMM 솔버는 모든 레이어를 균일 슬래브로 처리하므로, 마이크로렌즈 시프트가 TMM의 R/T/A 값에 영향을 미치지 않습니다. 시프트는 실제 마이크로렌즈 형상과 횡방향 광 분포를 모델링하는 RCWA에서만 의미가 있습니다. CRA 시프트 보상의 완전한 QE 영향을 보려면 torcwa 또는 grcwa를 사용하세요.
:::

## 실행 환경

```
솔버        : TMM (Transfer Matrix Method)
백엔드      : NumPy (CPU)
Python      : 3.11.6
PyTorch     : 2.5.0 (사용 가능하지만 TMM에서는 미사용)
플랫폼      : macOS (Darwin 25.2.0, Apple Silicon)
```

| 시뮬레이션 | 파장 수 | 실행 시간 |
|-----------|:-------:|----------:|
| 단일 파장 (550 nm) | 1 | 0.8 ms |
| 전체 스윕 (380–780 nm, 20 nm 간격) | 21 | 2.8 ms |
| 전체 스윕 (380–780 nm, 10 nm 간격) | 41 | ~4 ms |
| CRA 스윕 (7 각도 × 2 설정) | 14 실행 | ~12 ms |
